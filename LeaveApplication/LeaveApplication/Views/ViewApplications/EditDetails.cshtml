
@{
    ViewBag.Title = "EditDetails";
    Layout = "~/Views/Shared/EmpProfileLayOut.cshtml";
}

@model LeaveApplication.Models.LeaveApplication
@*<h2>Index</h2>*@
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Leave</title>
    @*<link rel="stylesheet" href="main.css">*@
    <link rel="stylesheet" href="~/Content/main.css" />
 
    <script>

        var FromDate = null;
        var ToDate = null;
        function DateSelect(date) {

            var LeaveDetails = { FromDate: "", ToDate: "" };

            if (date.name == "FromDate") {
                FromDate = date.value;
                LeaveDetails.FromDate = FromDate;
                LeaveDetails.ToDate = ToDate;

            } else {
                ToDate = date.value;
                LeaveDetails.FromDate = FromDate;
                LeaveDetails.ToDate = ToDate;

            }


            if (FromDate != null && ToDate != null) {

                var xmlhttp = new XMLHttpRequest();
                xmlhttp.onreadystatechange = fun;
                function fun() {
                    if (this.readyState == 4 && this.status == 200) {

                        var x = JSON.parse(this.responseText);

                        document.getElementById("days").value = x;

                    }
                };
                xmlhttp.open("POST", "/ApplyForLeave/Calculateadays", true);
                xmlhttp.setRequestHeader("Content-Type", "application/json");
                xmlhttp.send(JSON.stringify(LeaveDetails));
            }


        }

/**/</script>
</head>

<body>


    <div id="div1" class="container">
        <div class="row  justify-content-center ">

            <div class="col-sm-4  offset-2">

                @using (Html.BeginForm("SaveChanges", "ViewApplications", FormMethod.Post, new { id = "form1" }))
                {
                    <label style="font-size:22px" id="date" for="">Date Of Application: @Model.ApplyDate</label>
                    <br><br>

                    <div class="form-group">
                        <select class="form-control" name="@Html.NameFor(m=>m.LeaveType)" id="@Html.IdFor(m=>m.LeaveType)">
                            <option selected disabled> Select Leave Type</option>
                            @{
                                foreach (LeaveApplication.Models.LeaveTypes x in ViewBag.Leavetypes)
                                {
                                    <option value="@x.LeaveTypeID">@x.LeaveType</option>
                                }
                            }
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="date1">From</label>
                        <input class="form-control" type="date" name="@Html.NameFor(m=>m.FromDate)" id="@Html.IdFor(m=>m.FromDate)" value="@Model.FromDate" required onchange="DateSelect(this)">
                    </div>
                    <div class="form-group">
                        <label for="date2">To</label>
                        <input class="form-control" type="date" name="@Html.NameFor(m=>m.ToDate)" id="@Html.IdFor(m=>m.ToDate)" value="@Model.ToDate" required onchange="DateSelect(this)">
                    </div>
                    <div class=" form-group">
                        <label for="days">Total Days</label>
                        <input class="form-control" type="text" name="days" value="@Model.TotalDays" id="days" disabled>

                    </div>
                    <div class="form-group">
                        <select class="form-control" name="@Html.NameFor(m=>m.LeaveReason)" id="@Html.IdFor(m=>m.LeaveReason)">
                            <option selected disabled>Reason For Leave</option>
                            @{ System.Data.DataSet i = ViewBag.Reasons;
                                foreach (System.Data.DataRow x in i.Tables[0].Rows)
                                {
                                    <option value="@x[0].ToString()">@x[1].ToString()</option>
                                }
                            }
                        </select>
                    </div>
                    <div class="form-group">
                        <textarea class="form-control" style="resize:none" name="@Html.NameFor(m=>m.LeaveRemarks)" id="@Html.IdFor(m=>m.LeaveRemarks)" cols="30" rows="10" placeholder="Enter Description if any.">@Model.LeaveRemarks</textarea>
                    </div>

                    <input id="Submit1" class="btn btn-primary btn-block" type="submit" value="Save Changes" />

                }

            </div>
        </div>
 
    </div>
    <div class="clearfix">
        <div class=" float-right">

            <button class="btn btn-outline-primary " onclick="window.location.href='/ViewApplications/'">Go back</button>

        </div>
    </div>
    
    <script>
    FromDate = document.getElementById("FromDate").value;
    ToDate = document.getElementById("ToDate").value;

            document.getElementById("LeaveType").value = "@Model.LeaveTypeID";
     document.getElementById("LeaveReason").value = "@Model.LeaveReason";

    </script>
</body>

</html>


