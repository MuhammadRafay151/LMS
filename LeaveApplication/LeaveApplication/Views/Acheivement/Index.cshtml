@{
    ViewBag.Title = "Acheivements";
    Layout = "~/Views/Shared/EmpProfileLayOut.cshtml";
}

@model LeaveApplication.Models.Acheivement
<div class="modal fade " id="d1" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <h3>Are you sure to delete this item?</h3>
            </div>
            <div class="modal-footer">
                <div class="d-flex justify-content-end">
                    <button data-dismiss="modal" class="btn btn-link">Cancel</button>

                    <button id="dl" type="submit" class="btn btn-info-grd">Yes</button>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="editach">
    <div class="modal-dialog">
        @using (Html.BeginForm("UpdateAcheivement", "Acheivement", FormMethod.Post, new { id = "uf1", enctype = "multipart/form-data" }))
        {
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Edit Education</h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>

                <div class="modal-body">

                    <div class="row">
                        <div class="col">
                            <div class="form-group">
                                <label>Title</label>
                                <input type="text" id="updatetittle" name="title" class="form-control col-12" required>
                                @Html.ValidationMessage("title", "", new { @class = "text-danger" })
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col">

                            <div class="form-group">
                                <label>Date</label>
                                <input type="datetime" id="Updateachdate" name="AcheivementDate" class="form-control datetimepicker col-12" required>
                                @Html.ValidationMessage("AcheivementDate", "", new { @class = "text-danger" })
                            </div>
                        </div>
                        <div class="col">
                            <div class="form-group form-file-upload form-file-multiple">
                                <label>Attachement</label>
                                <input type="file" id="ufl" name="File" />
                                <div class="input-group">
                                    <input type="text" id="updatefilename" name="FileName" class="form-control inputFileVisible col-12" placeholder="Select FIle">
                                    <span class="input-group-btn">
                                        <button type="button" id="fID" data-id="" class="lf btn btn-fab btn-round btn-primary" data-toggle="tooltip" data-placement="top" title="Download File">
                                            <i class="material-icons">cloud_download</i>
                                        </button>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="d-flex justify-content-center">
                        <div class="p-1 col-12" style="border:solid 1px #A9A9A9">
                            <label>Description</label>
                            @Html.TextArea("Description", new { @class = "form-control col-12", id = "updateDes", required = "required", style = "font-size:22px", cols = "20", rows = "6" })
                            @Html.ValidationMessage("Description", "", new { @class = "text-danger" })
                        </div>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-link" data-dismiss="modal">Close</button>
                    <button type="submit" id="achid" name="AcheivementId" class="btn btn-info">Save</button>
                </div>
            </div>

        }
    </div>
</div>
<div class="container">

    <div class="row mt-5">

        <div class="col-12 d-flex justify-content-center">
            <div class="card ">
                <div class="card-header ">
                    <div class="row">
                        <div class="col">
                            <div class="card-title" style="font-family:g1;font-size:22px">Achievements</div>
                        </div>
                        <div class="col d-flex justify-content-end">
                            <a id="h1" href="#"><img id="ic" width="20" src="~/Images/icons/matticons_solid_collapse-511.png" /></a>
                        </div>
                    </div>
                </div>
                @using (Html.BeginForm("AddAcheivement", "Acheivement", FormMethod.Post, new { id = "f1", enctype = "multipart/form-data" }))
                {
                    <div id="c1" class="card-body">
                        <form action="#" method="post">
                            <div class="row">
                                <div class="col">
                                    <div class="form-group">
                                        <input type="text" id="title" name="title" class="form-control col-12" placeholder="Title" required>
                                        @Html.ValidationMessage("title", "", new { @class = "text-danger" })
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col">
                                    <div class="form-group">
                                        <input type="datetime" id="AcheivementDate" name="AcheivementDate" class="form-control datetimepicker col-12" placeholder="Date" required>
                                        @Html.ValidationMessage("AcheivementDate", "", new { @class = "text-danger" })
                                    </div>
                                </div>
                                <div class="col">
                                    <div class="form-group form-file-upload form-file-multiple">

                                        <input type="file" id="fl" name="File" />

                                        <div class="input-group">
                                            <input type="text" id="fl1" name="FileName" class="form-control inputFileVisible col-12" placeholder="Attach Document" required>
                                            <span class="input-group-btn">
                                                <button type="button" class="btn btn-fab btn-round btn-primary">
                                                    <i class="material-icons">attach_file</i>
                                                </button>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group d-flex justify-content-center">
                                <div class="p-1 col-12" style="border:solid 1px #A9A9A9">

                                    @Html.TextArea("Description", new { @class = "form-control col-12", required = "required", placeholder = "Description", style = "font-size:22px", cols = "20", rows = "6" })
                                    @Html.ValidationMessage("Description", "", new { @class = "text-danger" })
                                </div>
                            </div>
                            <button type="submit" class="btn btn-block btn-round btn-outline-info">Add Acheivements</button>
                        </form>
                    </div>
                }
            </div>
        </div>
    </div>
    @{
        System.Data.DataSet ds = ViewBag.data;

    }
    @foreach (System.Data.DataRow i in ds.Tables[0].Rows)
    {
        <div class="row justify-content-center">

            <div class="col">
                <div class="card ">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-6">
                                <h3 class="card-title">@i[3]</h3>
                                <small class="card-title">Achievement Date: @DateTime.Parse(i[4].ToString()).ToString("dd/MM/yyyy")</small>
                            </div>
                            <div class="col ">

                                <div class="d-flex justify-content-end">
                                    <a class="dropdown-toggle" data-toggle="dropdown"></a>

                                    <div class="dropdown-menu dropdown-menu-right ">
                                        <a class="dropdown-item edt" data-id="@i[0]" data-toggle="modal" data-target="#editach" href="#">Edit</a>
                                        <a data-id="@i[0]" class="dropdown-item dl" data-toggle="modal" data-target="#d1" href="#">Delete</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <table class="table table-hover">
                            <tbody>

                                <tr>
                                    <th class="text-info" scope="row">Description</th>
                                    <td> @i[5]</td>
                                    <td></td>
                                </tr>

                                <tr>
                                    <th class="text-info" scope="row">Attachment</th>
                                    <td><a href="/Acheivement/DownLoadFile?FileID=@i[1]">@i[6]</a></td>
                                    <td></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

    }
</div>

<script>
    $(document).ready(function () {
        $('#h1').click(function () {
            if ($('#c1').is(':visible')) {
                $('#c1').hide('fade');
                $('#ic').attr('src', '/Images/icons/matticons_solid_expand-512.png');
            } else {
                $('#c1').show('fade');
                $('#ic').attr('src', '/Images/icons/matticons_solid_collapse-511.png');
            }

        })
        $('#fl1').click(function () {
            $('#fl').trigger('click');
        });

        $('#updatefilename').click(function () {
            $('#ufl').trigger('click');
        });
        $('#ufl').change(function () {

            document.getElementById('updatefilename').value = document.getElementById('ufl').files.item(0).name;

        });
        $('#fl').change(function () {

            document.getElementById('fl1').value = document.getElementById('fl').files.item(0).name;

        });
        $('.dl').click(function () {
            var x = $(this).data("id");
            $('#dl').data("id", x);

        });
        $('#dl').click(function () {
            var z = $('#dl').data("id");
            window.location.href = "/Acheivement/DeleteAcheivement?AcheivementId=" + z;
        })
        $('.lf').click(function () {
            var z = $('#fID').data("id");
            window.location.href = "/Acheivement/DownLoadFile?FileID=" + z;
        })

        $('.edt').click(function () {

            var id = $(this).data("id");

            $.ajax({
                type: "GET",
                url: "/Acheivement/GetAcheivement?AcheivementID=" + id,
                success: function (data) {
                    var jsondata = JSON.parse(data);
                    $('#updatetittle').val(jsondata.Table[0].Title);
                    var Date = moment(jsondata.Table[0].Date).format('DD/MM/YYYY');
                    $('#Updateachdate').val(Date);
                    $('#updatefilename').val(jsondata.Table[0].FileName);
                    $('#updateDes').val(jsondata.Table[0].Description);
                    $('#fileid').val(jsondata.Table[0].FileID);
                    $('#achid').val(jsondata.Table[0].AcheivementID);
                    var fid = jsondata.Table[0].FileID;
                    $('#fID').data("id", fid);

                }

            })
        });

    });
</script>
<script src="~/Scripts/DateTimePickerHelper.js"></script>